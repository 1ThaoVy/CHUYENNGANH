<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Danh m·ª•c - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="admin-styles.css">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#06B6D4', sidebar: '#1e293b' } } }
        }
    </script>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 text-white h-screen flex flex-col fixed left-0 top-0 overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center space-x-3 mb-8">
                    <img src="http://localhost:3001/images/logo.png?v=2" alt="Logo" class="h-10 w-10 rounded-full">
                    <div>
                        <h2 class="text-xl font-bold">Orianna Admin</h2>
                        <p class="text-gray-400 text-sm">Qu·∫£n tr·ªã vi√™n</p>
                    </div>
                </div>
            </div>
            
            <nav class="px-4 pb-4 flex-1 flex flex-col justify-between">
            <div class="space-y-1">
                <a href="dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">üìä</span>
                    <span>T·ªïng quan</span>
                </a>
                <a href="manage-products.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">üì¶</span>
                    <span>S·∫£n ph·∫©m</span>
                </a>
                <a href="orders.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">üõí</span>
                    <span>ƒê∆°n h√†ng</span>
                </a>
                <a href="manage-categories.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-primary text-white mb-2">
                    <span class="text-xl">üè∑Ô∏è</span>
                    <span>Danh m·ª•c</span>
                </a>
                <a href="manage-news.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">üì∞</span>
                    <span>Tin t·ª©c</span>
                </a>
                <a href="manage-flash-sale.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">‚ö°</span>
                    <span>Flash Sale</span>
                </a>
                <a href="customers.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">üë•</span>
                    <span>Kh√°ch h√†ng</span>
                </a>
                <a href="settings.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                    <span class="text-xl">‚öôÔ∏è</span>
                    <span>C√†i ƒë·∫∑t</span>
                </a>
            </div>
                
            <div class="border-t border-gray-700 pt-4 mt-4">
                    <a href="../index.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 mb-2">
                        <span class="text-xl">üè†</span>
                        <span>V·ªÅ trang ch·ªß</span>
                    </a>
                    <button onclick="logout()" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-700 w-full text-left">
                        <span class="text-xl">üö™</span>
                        <span>ƒêƒÉng xu·∫•t</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col ml-64">
            <!-- Top Bar -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-6 py-4">
                    <h2 class="text-2xl font-bold text-gray-800">Qu·∫£n l√Ω Danh m·ª•c</h2>
                    <button onclick="showAddModal()" class="bg-primary hover:bg-cyan-600 text-white px-6 py-2 rounded-lg font-medium">
                        ‚ûï Th√™m Danh m·ª•c
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="mb-6">
                    <p class="text-gray-600">Qu·∫£n l√Ω c√°c th∆∞∆°ng hi·ªáu n∆∞·ªõc hoa</p>
                </div>

                <!-- Categories Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">ID</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">T√™n Danh m·ª•c</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Slug</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">M√¥ t·∫£</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">S·ªë s·∫£n ph·∫©m</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="categories-table">
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-gray-500">ƒêang t·∫£i...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </main>
        </div>

    <!-- Add/Edit Modal -->
    <div id="category-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 id="modal-title" class="text-2xl font-bold mb-6">Th√™m Danh m·ª•c</h3>
            
            <form id="category-form" class="space-y-4">
                <input type="hidden" id="category-id">
                
                <div>
                    <label class="block text-sm font-semibold mb-2">T√™n Danh m·ª•c *</label>
                    <input type="text" id="ten_danh_muc" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Slug *</label>
                    <input type="text" id="slug" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    <p class="text-sm text-gray-500 mt-1">VD: chanel, dior, gucci</p>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">M√¥ t·∫£</label>
                    <textarea id="mo_ta" rows="3"
                              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-primary hover:bg-cyan-600 text-white py-2 rounded-lg font-semibold">
                        L∆∞u
                    </button>
                    <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded-lg font-semibold">
                        H·ªßy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="admin-auth.js"></script>
    <script>
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '../login.html';
            }
        }
    </script>
    <script>
        let categories = [];

        // Load categories
        async function loadCategories() {
            try {
                const data = await apiCall('/categories');
                categories = data.data;
                displayCategories();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('categories-table').innerHTML = `
                    <tr><td colspan="6" class="px-6 py-4 text-center text-red-500">L·ªói t·∫£i d·ªØ li·ªáu</td></tr>
                `;
            }
        }

        // Display categories
        function displayCategories() {
            const tbody = document.getElementById('categories-table');
            
            if (categories.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Ch∆∞a c√≥ danh m·ª•c n√†o</td></tr>
                `;
                return;
            }

            tbody.innerHTML = categories.map(cat => `
                <tr class="border-t hover:bg-gray-50">
                    <td class="px-6 py-4">${cat.danh_muc_id}</td>
                    <td class="px-6 py-4 font-semibold">${cat.ten_danh_muc}</td>
                    <td class="px-6 py-4 text-gray-600">${cat.slug}</td>
                    <td class="px-6 py-4 text-gray-600">${cat.mo_ta || '-'}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                            ${cat.so_luong_san_pham || 0} s·∫£n ph·∫©m
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="editCategory(${cat.danh_muc_id})" class="text-blue-600 hover:text-blue-800 mr-3">
                            ‚úèÔ∏è S·ª≠a
                        </button>
                        <button onclick="deleteCategory(${cat.danh_muc_id})" class="text-red-600 hover:text-red-800">
                            üóëÔ∏è X√≥a
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Show add modal
        function showAddModal() {
            document.getElementById('modal-title').textContent = 'Th√™m Danh m·ª•c';
            document.getElementById('category-form').reset();
            document.getElementById('category-id').value = '';
            document.getElementById('category-modal').classList.remove('hidden');
        }

        // Edit category
        function editCategory(id) {
            const category = categories.find(c => c.danh_muc_id === id);
            if (!category) return;

            document.getElementById('modal-title').textContent = 'S·ª≠a Danh m·ª•c';
            document.getElementById('category-id').value = category.danh_muc_id;
            document.getElementById('ten_danh_muc').value = category.ten_danh_muc;
            document.getElementById('slug').value = category.slug;
            document.getElementById('mo_ta').value = category.mo_ta || '';
            document.getElementById('category-modal').classList.remove('hidden');
        }

        // Close modal
        function closeModal() {
            document.getElementById('category-modal').classList.add('hidden');
        }

        // Handle form submit
        document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const categoryId = document.getElementById('category-id').value;
            const formData = {
                ten_danh_muc: document.getElementById('ten_danh_muc').value,
                slug: document.getElementById('slug').value,
                mo_ta: document.getElementById('mo_ta').value
            };

            try {
                if (categoryId) {
                    // Update
                    await apiCall(`/categories/${categoryId}`, 'PUT', formData);
                    alert('C·∫≠p nh·∫≠t danh m·ª•c th√†nh c√¥ng!');
                } else {
                    // Create
                    await apiCall('/categories', 'POST', formData);
                    alert('Th√™m danh m·ª•c th√†nh c√¥ng!');
                }
                
                closeModal();
                loadCategories();
            } catch (error) {
                alert('L·ªói: ' + error.message);
            }
        });

        // Delete category
        async function deleteCategory(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c n√†y?')) return;

            try {
                await apiCall(`/categories/${id}`, 'DELETE');
                alert('X√≥a danh m·ª•c th√†nh c√¥ng!');
                loadCategories();
            } catch (error) {
                alert('L·ªói: ' + error.message);
            }
        }

        // Auto generate slug
        document.getElementById('ten_danh_muc').addEventListener('input', (e) => {
            const slug = e.target.value
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/ƒë/g, 'd')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            document.getElementById('slug').value = slug;
        });

        // Load on page load
        loadCategories();
    </script>
</body>
</html>
